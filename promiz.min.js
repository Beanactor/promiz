!function(){function a(b,c){var d=this;d.promise=d;var e="pending",f=null,g=null,b=b||null,c=c||null,h=[];d.resolve=function(a){if("pending"===e){if(g&&"pending"===g.state)return g.resolve(a);f=a,e="resolving",setImmediate(function(){k()})}},d.reject=function(a){if("pending"===e){if(g&&"pending"===g.state)return g.reject(a);f=a,e="rejecting",setImmediate(function(){k()})}},d.then=function(b,c){var g=new a(b,c);return h.push(g),g.prev=d,"resolved"===e&&g.resolve(f),"rejected"===e&&g.reject(f),g},d.fail=function(a){return d.then(null,a)};var i=function(a){e=a,"resolved"===e&&h.map(function(a){a.resolve(f)}),"rejected"===e&&h.map(function(a){a.reject(f)})},j=function(a,b,c,d){if("object"==typeof f&&"function"==typeof a)try{var e=0;a.call(f,function(a){0===e++&&(f=a,b())},function(a){0===e++&&(f=a,c())})}catch(g){f=g,c()}else d()},k=function(){var a;try{a=f&&f.then}catch(g){return f=g,e="rejecting",k()}j(a,function(){e="resolving",k()},function(){e="rejecting",k()},function(){if("resolving"===e&&"function"==typeof b)try{f=b(f)}catch(g){return f=g,i("rejected")}if("rejecting"===e&&"function"==typeof c)try{f=c(f),e="resolving"}catch(g){return f=g,i("rejected")}return f===d?(f=TypeError(),i("rejected")):(j(a,function(){i("resolved")},function(){i("rejected")},function(){"resolving"===e?i("resolved"):i("rejected")}),void 0)})}}var b={defer:function(){return new a(null,null)}};"undefined"!=typeof module?module.exports=b:self.Promiz=b}();