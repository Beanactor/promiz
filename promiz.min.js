!function(){function g(){this.state="pending";this.val=null;this.stack=[];this.failing=!1;this.resolve=function(a){"pending"===this.state&&(this.state="resolved",this.fire(a));return this};this.reject=function(a){"pending"===this.state&&(this.state="rejected",this.fire(a));return this};this.then=function(a,b){this.stack.push([a,b]);"pending"!==this.state&&this.fire();return this};this.done=function(){this.failing=!0;"pending"!==this.state&&this.fire();return null};this.fail=function(a){return this.then(null,
a)};this.nodeify=function(a){function b(a){"undefined"!==typeof process&&process.nextTick?process.nextTick(a):setTimeout(a,0)}a&&this.then(function(c){b(function(){a(null,c)});return c},function(c){b(function(){a(c)})});return this};this.spread=function(a,b){return this.all().then(function(b){return a?a.apply(null,b):null},b)};this.all=function(){var a=new g;this.stack.push([function(b){b=b?b instanceof Array?b:[b]:[];if(0===b.length)return b;for(var c=0,d=b.length,e=d;e--;)(function(){var f=e,h=
b[f];h&&h.then?h.then(function(e){b[f]=e;c++;c===d&&a.resolve(b)},function(b){a.reject(b)}):(b[f]=h,c++,c===d&&a.resolve(b))})();return null},null]);"pending"!==this.state&&this.fire();return a};this.fire=function(a){var b=this;for(a=this.val="undefined"!==typeof a?a:this.val;this.stack.length&&"pending"!==this.state;){var c=this.stack.shift(),d="rejected"===this.state?c[1]:c[0];if(d)try{if((a=this.val=d.call(null,a))&&"function"===typeof a.then){var e=this.state;this.state="pending";a.then(function(a){b.resolve(a)},
function(a){"rejected"!==e&&c[1]&&b.stack.unshift(c);b.reject(a)})}else this.state="resolved"}catch(f){a=this.val=f,"rejected"!==this.state&&c[1]&&this.stack.unshift(c),this.state="rejected"}}if(this.failing&&0===this.stack.length&&"rejected"===this.state)throw this.val;}}var k={defer:function(){return new g},fcall:function(){var a=new g,b=Array.apply([],arguments),c=b.shift();try{var d=c.apply(null,b);a.resolve(d)}catch(e){a.reject(e)}return a},nfcall:function(){var a=new g,b=Array.apply([],arguments),
c=b.shift();try{b.push(function(b,c){return b?a.reject(b):a.resolve(c)}),c.apply(null,b)}catch(d){a.reject(d)}return a}};"undefined"!==typeof module&&module.exports?module.exports=k:this.Promiz=k}();