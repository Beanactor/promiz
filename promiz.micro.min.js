!function(){function a(b,c){var d=this;d.promise=d;var e=0,f=0,g=0,b=b||0,c=c||0,h=[];d.resolve=function(a){if(!e){if(g&&!g.state)return g.resolve(a);f=a,e=1,setImmediate(function(){k()})}},d.reject=function(a){if(!e){if(g&&!g.state)return g.reject(a);f=a,e=2,setImmediate(function(){k()})}},d.then=function(b,c){var g=new a(b,c);return h.push(g),g.prev=d,3==e&&g.resolve(f),4==e&&g.reject(f),g};var i=function(a){e=a,3==e&&h.map(function(a){a.resolve(f)}),4==e&&h.map(function(a){a.reject(f)})},j=function(a,b,c,d){if("object"==typeof f&"function"==typeof a)try{var e=0;a.call(f,function(a){e++||(f=a,b())},function(a){e++||(f=a,c())})}catch(g){f=g,c()}else d()},k=function(){var a;try{a=f&&f.then}catch(g){return f=g,e=2,k()}j(a,function(){e=1,k()},function(){e=2,k()},function(){if(1==e&"function"==typeof b)try{f=b(f)}catch(g){return f=g,i(4)}if(2==e&"function"==typeof c)try{f=c(f),e=1}catch(g){return f=g,i(4)}return f==d?(f=TypeError(),i(4)):(j(a,function(){i(3)},function(){i(4)},function(){1==e?i(3):i(4)}),void 0)})}}var b={defer:function(){return new a(0,0)}};"undefined"!=typeof module?module.exports=b:this.Promiz=b}();